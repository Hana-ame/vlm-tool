<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>脚本加载管理（固定版）</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
            color: #333;
            background-color: #f5f5f5;
        }

        h1 {
            text-align: center;
            color: #2c3e50;
        }

        .list-container {
            margin-top: 20px;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .script-item {
            display: flex;
            align-items: center;
            padding: 18px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background 0.2s;
        }

        .script-item:last-child {
            border-bottom: none;
        }

        .script-item:hover {
            background-color: #f0f7ff;
        }

        /* 复选框样式放大一点方便点击 */
        input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .script-info {
            flex-grow: 1;
            margin-left: 15px;
        }

        .script-name {
            font-weight: bold;
            display: block;
            margin-bottom: 4px;
            font-size: 1.1em;
            color: #007bff;
        }

        .script-desc {
            font-size: 0.9em;
            color: #555;
            display: block;
            line-height: 1.4;
        }

        .script-url {
            font-size: 0.75em;
            color: #999;
            display: block;
            margin-top: 6px;
            font-family: monospace;
            word-break: break-all;
        }

        .status-tag {
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 10px;
        }

        .enabled-text {
            color: #28a745;
        }

        .disabled-text {
            color: #dc3545;
        }
    </style>
</head>

<body>
    <h1>脚本功能开关</h1>

    <div id="scriptList" class="list-container">
        <!-- 列表由 JS 渲染 -->
    </div>

    <script>
        // const STORAGE_KEY = 'fixed_loader_settings';
        const STORAGE_KEY = 'custom_loader_scripts';

        // 固定的脚本列表数据
        const FIXED_SCRIPTS = [{
                name: "tampermonkey polyfill",
                describe: "基础运行环境",
                url: "https://config.810114.xyz/exhentai/gm-polyfill.js",
                defaultEnabled: true
            },
            {
                name: "聊天室",
                describe: "页面右下角的蓝色社交气泡",
                url: "https://inline-chat.moonchan.xyz/loader.js",
                defaultEnabled: true
            },
            {
                name: "EhSyringe (汉化)",
                describe: "E站注射器：将全站 UI 及 37000+ 标签翻译为中文。",
                url: "https://config.810114.xyz/exhentai/EhSyringe.user.js",
                defaultEnabled: false
            },
            {
                name: "ComicRead (漫画增强)",
                describe: "双页阅读、翻页优化，支持 E-Hentai、拷贝漫画、nhentai 等主流站点。",
                url: "https://config.810114.xyz/exhentai/ComicRead.user.js",
                defaultEnabled: false
            },
            {
                name: "Ehentai画廊收藏助手",
                describe: "在画廊页面直接管理收藏和种子下载。",
                url: "https://config.810114.xyz/exhentai/Ehentai%E7%94%BB%E5%BB%8A%E6%94%B6%E8%97%8F%E5%8A%A9%E6%89%8B.user.js",
                defaultEnabled: false
            },
            {
                name: "Ehentai画廊收藏助手 (BennyChou 版)",
                describe: "收藏助手的个人自用修改优化版。",
                url: "https://config.810114.xyz/exhentai/Ehentai%E7%94%BB%E5%BB%8A%E6%94%B6%E8%97%8F%E5%8A%A9%E6%89%8B%20%28BennyChou%20%E8%87%AA%E7%94%A8%E4%BF%AE%E6%94%B9%E7%89%88%29.user.js",
                defaultEnabled: false
            },
            {
                name: "解锁 Hath Perks",
                describe: "解锁站内 Hath 特权及增加辅助小工具。",
                url: "https://config.810114.xyz/exhentai/Unlock%20Hath%20Perks.user.js",
                defaultEnabled: false
            },
            {
                name: "东方永页机",
                describe: "终极自动翻页：加载并拼接下一页内容至当前页尾。",
                url: "https://config.810114.xyz/exhentai/Pagetual.user.js",
                defaultEnabled: false
            },
            {
                name: "ExResurrect",
                describe: "复活已经失效的 E/Ex 画廊列表。",
                url: "https://config.810114.xyz/exhentai/ExResurrect.user.js",
                defaultEnabled: false
            },
            {
                name: "Find Panda",
                describe: "搜索时自动检查 panda.chaika.moe 上的相关画廊。",
                url: "https://config.810114.xyz/exhentai/find%20panda.user.js",
                defaultEnabled: false
            },
            {
                name: "Sadpanda Favorites Export",
                describe: "批量保存/导出收藏夹数据为 JSON。",
                url: "https://config.810114.xyz/exhentai/Sadpanda%20SaveExport%20All%20Favorites.user.js",
                defaultEnabled: false
            },
            {
                name: "E-Hentai Downloader",
                describe: "将画廊直接下载为 Zip 压缩包。",
                url: "https://config.810114.xyz/exhentai/E-Hentai%20Downloader.user.js",
                defaultEnabled: false
            }
        ];

        // 从本地存储读取状态，如果没有则使用默认值
        let userSettings = JSON.parse(localStorage.getItem(STORAGE_KEY)) || {};

        function render() {
            const container = document.getElementById('scriptList');
            container.innerHTML = FIXED_SCRIPTS.map((s, index) => {
                // 如果用户之前没存过这个脚本的状态，就用它默认的
                const isEnabled = userSettings[s.url] !== undefined ? userSettings[s.url] : s.defaultEnabled;

                return `
                <label class="script-item">
                    <input type="checkbox" ${isEnabled ? 'checked' : ''} onchange="toggleScript('${s.url}', this.checked)">
                    <div class="script-info">
                        <span class="script-name">
                            ${s.name}
                            <span class="${isEnabled ? 'enabled-text' : 'disabled-text'} status-tag">
                                [${isEnabled ? '已启用' : '已禁用'}]
                            </span>
                        </span>
                        <span class="script-desc">${s.describe}</span>
                        <span class="script-url">${s.url}</span>
                    </div>
                </label>
            `
            }).join('');
        }

        function toggleScript(url, isChecked) {
            // 更新状态并保存到本地
            userSettings[url] = isChecked;
            localStorage.setItem(STORAGE_KEY, JSON.stringify(userSettings));
            // 重新渲染以更新文字状态
            render();
        }

        // 初始运行
        render();
    </script>
</body>

</html>