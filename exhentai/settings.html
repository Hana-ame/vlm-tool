<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LocalStorage 列表控制器</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
        background-color: #f5f7fa;
        display: flex;
        justify-content: center;
        padding-top: 50px;
        margin: 0;
        color: #333;
      }

      .container {
        background: white;
        width: 100%;
        max-width: 400px;
        border-radius: 16px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.08);
        overflow: hidden;
        padding-bottom: 20px;
      }

      .header {
        padding: 20px 24px;
        background: #fff;
        border-bottom: 1px solid #eee;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      h2 {
        margin: 0;
        font-size: 1.1rem;
      }

      .reset-btn {
        font-size: 0.8rem;
        color: #ff4d4f;
        cursor: pointer;
        border: 1px solid #ff4d4f;
        padding: 4px 10px;
        border-radius: 4px;
        background: transparent;
        transition: 0.2s;
      }

      .reset-btn:hover {
        background: #fff1f0;
      }

      .list-group {
        list-style: none;
        padding: 0;
        margin: 0;
      }

      .list-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 24px;
        border-bottom: 1px solid #f0f0f0;
        transition: background 0.2s;
      }

      .list-item:hover {
        background-color: #fafafa;
      }

      .item-info {
        display: flex;
        flex-direction: column;
      }

      .item-name {
        font-size: 1rem;
        font-weight: 500;
      }

      .item-key {
        font-size: 0.75rem;
        color: #999;
        margin-top: 4px;
        font-family: monospace;
      }

      /* --- 开关样式 (iOS 风格) --- */
      .switch {
        position: relative;
        display: inline-block;
        width: 50px;
        height: 28px;
        flex-shrink: 0;
        /* 防止开关被挤压 */
      }

      .switch input {
        opacity: 0;
        width: 0;
        height: 0;
      }

      .slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: #e0e0e0;
        transition: 0.3s;
        border-radius: 34px;
      }

      .slider:before {
        position: absolute;
        content: "";
        height: 22px;
        width: 22px;
        left: 3px;
        bottom: 3px;
        background-color: white;
        transition: 0.3s;
        border-radius: 50%;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
      }

      input:checked + .slider {
        background-color: #34c759;
        /* iOS Green */
      }

      input:checked + .slider:before {
        transform: translateX(22px);
      }
    </style>
  </head>

  <body>
    <div class="container">
      <div class="header">
        <h2>功能开关列表</h2>
        <button class="reset-btn" onclick="resetAll()">重置所有</button>
      </div>
      <ul class="list-group" id="switchList">
        <!-- JS 会在这里动态插入列表项 -->
      </ul>

      <div>
        <a
          href="https://page.moonchan.xyz/?url=https://pastebin.com/raw/VYyQTpSZ#markdown-parser"
          >一些vmess订阅</a
        >
      </div>
    </div>

    <script>
      // ================= 配置区域 =================
      // 在这里添加你需要控制的开关列表
      const configList = [
        {
          key: "waterfall",
          name: "下拉加载按钮",
          default: true,
        },
        {
          key: "chat",
          name: "右下角聊天气泡",
          default: true,
        },
        {
          key: "ehsyringe",
          name: "Tag翻译",
          default: true,
        },
        {
          key: "gscript",
          name: "画廊预览图全部加载（翻页阅读器前置）",
          default: true,
        },
        {
          key: "reader",
          name: "翻页阅读器",
          default: true,
        },
        {
          key: "reader-test",
          name: "翻页阅读器",
        },
      ];
      // ===========================================

      const listContainer = document.getElementById("switchList");

      /**
       * 渲染列表
       */
      function renderList() {
        listContainer.innerHTML = ""; // 清空当前列表

        configList.forEach((item) => {
          const storedValue = localStorage.getItem(item.key);
          // 如果 storedValue 不等于 null，说明有缓存，就对比字符串；否则使用默认值
          const isChecked =
            storedValue !== null ? storedValue === "true" : item.default;

          // 创建列表项 DOM
          const li = document.createElement("li");
          li.className = "list-item";

          li.innerHTML = `
                    <div class="item-info">
                        <span class="item-name">${item.key}</span>
                        <span class="item-key">${item.name}</span>
                    </div>
                    <label class="switch">
                        <input type="checkbox" data-key="${item.key}" ${
            isChecked ? "checked" : ""
          }>
                        <span class="slider"></span>
                    </label>
                `;

          // 绑定事件
          const input = li.querySelector("input");
          input.addEventListener("change", (e) => {
            const key = e.target.getAttribute("data-key");
            const val = e.target.checked;

            localStorage.setItem(key, val);
            console.log(`[Setting] ${key} = ${val}`);
          });

          listContainer.appendChild(li);
        });
      }

      /**
       * 重置所有 Key (移除或设为 false)
       */
      function resetAll() {
        if (!confirm("确定要重置所有开关为默认关闭状态吗？")) return;

        configList.forEach((item) => {
          localStorage.removeItem(item.key); // 或者 localStorage.setItem(item.key, 'false');
        });
        renderList(); // 重新渲染界面
      }

      /**
       * 监听其他标签页的修改同步
       */
      window.addEventListener("storage", (e) => {
        // 如果修改的 key 在我们的配置列表中，就刷新列表
        const isRelated = configList.some((item) => item.key === e.key);
        if (isRelated || e.key === null) {
          // e.key === null 代表 clear()
          renderList();
        }
      });

      // 初始化
      renderList();
    </script>
  </body>
</html>
